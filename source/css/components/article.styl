$hackerRed = #f03838
$hackerGray = #9e9e9e
$articleTitleColor = #212121
$articleTextColor = #424242
$articleCodeColor = #c7254e

$articleTitleDarkColor = #f6f2f5
$articleTextDarkColor = #fff
$articleCodeDarkColor = #f45542

article
  position relative
  padding 2rem 0

  a
    color $hackerRed

  .article-content, .article-excerpt
    /* 中文内容使用楷体（不倾斜） */
    em:lang(zh), em:lang(zh-CN), em:lang(zh-TW)
      font-style: normal !important
      font-family: "楷体", "KaiTi", "楷体_GB2312", "STKaiti", "华文楷体", serif !important
    
    /* 英文内容使用斜体 */
    em:lang(en), em:not([lang])
      font-style: italic !important
      font-family: "Times New Roman", Times, serif !important

  &:not(:first-child):before
    content ''
    width 150px
    height 1px
    background-color rgba(224, 224, 224, 0.5)
    position absolute
    top 0
    left 50%
    margin-left -75px

  blockquote
    margin 1.5rem 0
    padding 1.8rem 1.5rem 1.2rem 1.5rem
    line-height 1.8
    border-left 4px solid $hackerRed
    background-color rgba(240, 56, 56, 0.03)
    border-radius 0 8px 8px 0
    box-shadow 0 2px 8px rgba(0, 0, 0, 0.04)
    position relative
    overflow hidden
    transition all 0.3s ease
    
    & + blockquote
      margin-top 3rem
    
    &:before
      content '"'
      position absolute
      top 10px
      left 12px
      font-size 3.5rem
      color rgba(240, 56, 56, 0.1)
      font-family serif
      line-height 1
      z-index 0
    
    &:after
      content ''
      position absolute
      bottom 0
      left 0
      width 100%
      height 3px
      background linear-gradient(90deg, $hackerRed, transparent)
      opacity 0.3
    
    p
      position relative
      margin 0.8rem 0
      z-index 1
      
    p:first-child
      margin-top 0.5rem
      
    p:last-child
      margin-bottom 0
    
    cite, footer
      display block
      margin-top 10px
      font-size 0.9em
      color $hackerGray
      text-align right
      font-style normal
      
      &:before
        content '— '
      
      &:lang(zh), &:lang(zh-CN), &:lang(zh-TW)
        &:before
          content '—— '
      
      &:lang(en), &:not([lang])
        &:before
          content '— '

    &:hover
      transform translateY(-2px)
      box-shadow 0 4px 12px rgba(0, 0, 0, 0.08)
      background-color rgba(240, 56, 56, 0.05)

  .article-title
    position relative
    color $articleTitleColor
    font-size 2.4rem
    line-height 1.3
    text-align center
    margin 0
    padding 0 2rem

    a
      display block
      color $articleTitleColor

      span
        padding-bottom 3px
        -webkit-transition 0.15s
        transition 0.15s
        box-shadow inset 0 -2px 0 rgba(240, 56, 56, 0)

      &:hover
        color $articleTitleColor

        span
          box-shadow inset 0 -2px 0 rgba(240, 56, 56, 0.4)

  .article-top-meta
    position relative
    color $hackerGray
    font-size 1.3rem
    text-align center
    margin 1rem 0

    span
      margin 0 0.5rem

    a
      color $hackerGray
      &:hover
        color $hackerRed

      time
        font-style italic

  .article-excerpt, .article-content, .featured-media
    margin 4rem 0
    font-size 1.6rem
    color $articleTextColor

    p
      margin 2rem 0
      line-height 2.0
      
    ul, ol
      margin 2rem 0
      padding-left 2rem
      
      li
        margin-bottom 1rem
        line-height 1.7

    h2
      margin-top 3.5rem
      margin-bottom 2rem
      color $articleTitleColor
      
    h3
      margin-top 3rem
      margin-bottom 1.5rem
      color $articleTitleColor

    .excerpt-btn
      margin 4rem 0
      font-size 1.4rem

    img
      display block
      max-width: 100%
      height auto
      margin 1rem auto
      
    figure
      margin 1rem auto
      
      img
        margin 0 auto
        
      figcaption
        text-align center
        color $hackerGray
        font-size 1.4rem
        margin-top 0.5rem

  .article-footer
    .pull-left
      float left
    .pull-right
      float right

    &:after
      content " "
      display block
      clear both

    .article-meta > span:not(:last-child)
      margin-right 3rem

    .article-meta > span
      display inline-block

    .article-meta > span > span
      line-height 1
      vertical-align middle

    .article-meta
      font-size 1.3rem
      color $hackerGray

      a
        color $hackerGray
        &:hover
          color $hackerRed

      i
        vertical-align middle
        color $hackerGray
        margin-right 0.5rem

    .post-tags
      a
        display: inline-block
        text-decoration: none
        border-radius: 999em
        padding: 2px 8px
        color: #333
        background: #f2f2f2
        font-size: 14px
        transition: all 0.3s ease
        margin: 0 5px 5px 0
        
        &:hover
          color: #fff !important
          background-color: $hackerRed
          border-color: $hackerRed
          
        &:before
          content "#"

        &:not(:last-of-type):after
          content ""
          padding-right 0

  code
    padding 2px 4px
    margin-left 2px
    margin-right 2px
    color $articleCodeColor
    white-space normal
    border-radius 0

  .video-container
    position: relative;
    padding-bottom: 56.25%;
    padding-top: 0;
    height: 0;
    overflow: hidden;

    iframe
      position: absolute;
      top:0;
      left: 0;
      width: 100%;
      height: 100%;

  table
    max-width 100%
    width 100%

    caption
      padding 5px
      color #333
      background-color #e5e5e5

    th, td
      text-align left
      padding 0.6em
      vertical-align top

    th
      vertical-align bottom
      border-bottom 1px solid #e5e5e5

    tbody + tbody
      border-top 2px solid #e5e5e5

    .table
      background-color #fff


    .table-bordered
      border 1px solid #e5e5e5

    .table-striped tbody tr:nth-of-type(odd)
      background-color:#f2f2f2

    pre
      overflow-x auto
      overflow-y hidden

.post-toc
  position: fixed
  right: 0
  top: 80px
  width: 280px
  background: var(--toc-bg)
  padding: 20px 20px 20px 25px
  box-shadow: 0 8px 24px rgba(0,0,0,0.08)
  max-height: calc(100vh - 100px)
  overflow-y: auto
  transition: all 0.3s ease-in-out
  z-index: 100
  border-radius: 8px 0 0 8px
  animation: toc-slide-in 0.3s ease-out
  
  @keyframes toc-slide-in
    0%
      opacity: 0
      transform: translateX(20px)
    100%
      opacity: 1
      transform: translateX(0)
  
  &::-webkit-scrollbar
    width: 4px
    
  &::-webkit-scrollbar-track
    background: transparent
    
  &::-webkit-scrollbar-thumb
    background: rgba(158, 158, 158, 0.6)
    border-radius: 4px
    
    &:hover
      background: rgba(158, 158, 158, 0.8)
  
  &.toc-hidden
    transform: translateX(calc(100% - 25px))
    background: transparent
    box-shadow: none
    
  .toc-toggle
    position: absolute
    left: 0
    top: 50%
    transform: translateY(-50%)
    width: 25px
    height: 50px
    background: var(--toc-toggle-bg)
    box-shadow: -2px 0 8px rgba(0,0,0,0.1)
    border-radius: 6px 0 0 6px
    cursor: pointer
    display: flex
    align-items: center
    justify-content: center
    z-index: 101
    transition: all 0.2s ease-in-out
    
    &:hover
      width: 28px
      
      i
        color: $hackerRed
    
    i
      font-size: 16px
      color: var(--text-color)
      transition: all 0.3s ease-in-out
    
    &.toc-toggle-hidden
      i
        transform: rotate(180deg)

  .post-toc-content
    h2
      display: none
      
    ol
      counter-reset: section
      list-style-type: none
      margin-left: 0
      padding-left: 0
      
      li
        padding-left: 0
        line-height: 1.6
        margin-bottom: 8px
        position: relative
        transition: all 0.2s ease-in-out
        
        &:before
          content: ""
          position: absolute
          left: 0
          color: var(--text-color)
          font-size: 12px
          top: 2px
        
        ol
          counter-reset: subsection
          margin-top: 8px
          padding-left: 15px
          position: relative
          
          &:before
            content: ""
            position: absolute
            left: 0
            top: 0
            bottom: 8px
            width: 0
            background: rgba(158, 158, 158, 0.2)
          
          li
            &:before
              content: ""
              font-size: 11px
              
            ol
              counter-reset: subsubsection
              padding-left: 15px
              
              &:before
                content: ""
                position: absolute
                left: 0
                top: 0
                bottom: 8px
                width: 0
                background: rgba(158, 158, 158, 0.2)
              
              li:before
                content: ""
                font-size: 11px
    
    .toc-item-icon
      display: inline-block
      width: 18px
      height: 18px
      margin-right: 6px
      vertical-align: middle
      opacity: 0.8
      transition: all 0.2s ease
      
      &.emoji
        font-size: 16px
        line-height: 1
        margin-top: -2px
      
      &.img
        width: 16px
        height: 16px
        object-fit: contain
    
    .toc-link
      color: var(--text-color)
      text-decoration: none
      font-size: 14px
      display: block
      margin-left: 0
      position: relative
      transition: all 0.2s ease
      padding: 4px 8px
      border-radius: 4px
      
      &:hover
        color: $hackerRed
        transform: translateX(3px)
        background: rgba(240, 56, 56, 0.05)
        box-shadow: 0 2px 8px rgba(240, 56, 56, 0.08)
      
      &.active
        color: $hackerRed
        font-weight: 500
        background: rgba(240, 56, 56, 0.08)
        box-shadow: 0 2px 8px rgba(240, 56, 56, 0.12)
        animation: toc-pulse 2s infinite
        
        &:before
          content: ""
          position: absolute
          left: -10px
          top: 50%
          transform: translateY(-50%)
          width: 3px
          height: 16px
          background: $hackerRed
          border-radius: 2px

    ol > li
      position: relative
      
      &:before
        content: ""
        position: absolute
        left: -4px
        top: 10px
        width: 6px
        height: 6px
        border-radius: 50%
        background: rgba(240, 56, 56, 0.6)
        opacity: 0
        transition: all 0.2s ease
      
      &:hover:before
        opacity: 1
      
      &.active:before
        opacity: 1
        background: $hackerRed

// 暗色模式样式
[data-theme="dark"]
  article
    .article-title
      color $articleTitleDarkColor
      a
        color $articleTitleDarkColor

    .article-excerpt, .article-content, .featured-media
      color $articleTextDarkColor

      h2, h3, h4, h5, h6
        color $articleTitleDarkColor

      code
        color $articleCodeDarkColor
        background-color rgba(255, 255, 255, 0.1)

      blockquote
        background-color rgba(240, 56, 56, 0.08)
        box-shadow 0 2px 8px rgba(0, 0, 0, 0.15)
        
        &:before
          color rgba(240, 56, 56, 0.15)
        
        &:after
          background linear-gradient(90deg, $hackerRed, transparent)
          opacity 0.4
        
        cite, footer
          color rgba(255, 255, 255, 0.7)
          font-style normal
          
          &:lang(zh), &:lang(zh-CN), &:lang(zh-TW)
            &:before
              content '—— '
          
          &:lang(en), &:not([lang])
            &:before
              content '— '
        
        &:hover
          background-color rgba(240, 56, 56, 0.12)
          box-shadow 0 4px 12px rgba(0, 0, 0, 0.25)

    .post-tags
      a
        color: #fff
        background: rgba(255, 255, 255, 0.1)
        
        &:hover
          color: #fff !important
          background-color: var(--link-color)
          border-color: var(--link-color)
          
        &:before
          color: #fff

  // 暗色模式下的目录面板样式
  .post-toc
    background: var(--card-bg)
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2)
    
    &::-webkit-scrollbar-thumb
      background: rgba(158, 158, 158, 0.4)
      
      &:hover
        background: rgba(158, 158, 158, 0.6)
    
    .toc-toggle
      background: var(--card-bg)
      box-shadow: -2px 0 8px rgba(0, 0, 0, 0.2)
    
    .post-toc-content
      h2
        display: none
      
      ol li ol:before, 
      ol li ol ol:before
        background: rgba(158, 158, 158, 0.15)
        width: 0
      
      .toc-link
        &:hover
          background: rgba(240, 56, 56, 0.1)
        
        &.active
          background: rgba(240, 56, 56, 0.15)
      
      ol > li:before
        background: rgba(240, 56, 56, 0.5)

// 脚注弹出层样式
.footnote-popup
  position: fixed
  width: 360px
  background: var(--card-bg)
  border: 1px solid var(--border-color)
  border-radius: 12px
  padding: 16px 20px
  box-shadow: 0 6px 30px rgba(0, 0, 0, 0.12)
  z-index: 1000
  font-size: 15px
  line-height: 1.6
  color: var(--text-color)
  max-height: 300px
  overflow-y: auto
  opacity: 0
  transform: scale(0.98) translateY(5px)
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1)
  backdrop-filter: blur(10px)
  will-change: transform, opacity
  
  &.active
    opacity: 1
    transform: scale(1) translateY(0)
    transition-timing-function: cubic-bezier(0, 0, 0.2, 1)
  
  &::-webkit-scrollbar
    width: 4px
    
  &::-webkit-scrollbar-track
    background: transparent
    
  &::-webkit-scrollbar-thumb
    background: var(--border-color)
    border-radius: 2px
    
  p
    margin: 0.5rem 0
    font-size: 15px
    line-height: 1.6
    
  a
    color: var(--link-color)
    text-decoration: none
    transition: all 0.2s ease
    
    &:hover
      color: $hackerRed
      text-decoration: underline

// 脚注引用样式优化
.footnote-ref
  display: inline-flex
  align-items: center
  justify-content: center
  font-size: 0.85em
  padding: 0 1px
  line-height: 1
  text-decoration: none
  color: $hackerRed
  background-color: transparent
  transition: all 0.3s ease
  position: relative
  top: -0.3em
  margin: 0 1px
  cursor: pointer
  
  &:hover, &.active
    color: darken($hackerRed, 10%)
    transform: translateY(-1px)
  
  a
    color: inherit
    text-decoration: none

// 脚注区域样式优化
.footnotes
  position: relative
  margin-top: 60px
  padding-top: 20px
  border-top: 1px solid var(--border-color)
  font-size: 0.95em
  color: var(--text-color)
  
  &:before
    content: ""
    position: absolute
    top: -12px
    left: 50%
    transform: translateX(-50%)
    background: var(--card-bg)
    padding: 0 15px
    font-size: 1.1em
    font-weight: 500
    color: $hackerRed
  
  ol
    list-style-type: decimal
    padding-left: 1.5em
    margin-left: 0
    margin-top: 10px
    
    li
      position: relative
      margin-bottom: 12px
      padding-left: 0
      color: var(--text-color)
  
  .footnote-backref
    display: inline-flex
    align-items: center
    margin-left: 8px
    color: var(--link-color)
    text-decoration: none
    font-size: 0.9em
    opacity: 0.6
    transition: all 0.2s ease
    
    &:before
      content: "↩"
      margin-right: 4px
      font-size: 1.1em
    
    &:hover
      opacity: 1
      transform: translateX(-3px)

// 暗色模式适配
[data-theme="dark"]
  .footnote-popup
    background: rgba(28, 28, 30, 0.98)
    border-color: #444
    box-shadow: 0 6px 30px rgba(0, 0, 0, 0.3)
  
  .footnote-ref
    color: $hackerRed
    
    &:hover, &.active
      color: lighten($hackerRed, 10%)
  
  .footnotes
    border-color: #444
    
    &:before
      background: var(--card-bg)
      color: $hackerRed
    
    ol li:before
      color: $hackerRed

@keyframes toc-pulse
  0%
    box-shadow: 0 2px 8px rgba(240, 56, 56, 0.12)
  50%
    box-shadow: 0 2px 12px rgba(240, 56, 56, 0.25)
  100%
    box-shadow: 0 2px 8px rgba(240, 56, 56, 0.12)
