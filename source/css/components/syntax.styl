// 代码块颜色变量
$codeBgLight = #f8f9fa
$codeBorderLight = #ebedef
$codeTextLight = #383a42
$codeLangLight = #666
$codeLineLight = #9e9e9e
$codeHighlightLight = rgba(0, 0, 0, 0.05)

$codeBgDark = #282c34
$codeBorderDark = #3e4451
$codeTextDark = #abb2bf
$codeLangDark = #888
$codeLineDark = #636d83
$codeHighlightDark = rgba(255, 255, 255, 0.05)

// 代码块基础样式
figure.highlight
  position relative
  margin 1.5em 0
  padding 2em 0 0  // 增加顶部内边距，为语言标签和复制按钮留出空间
  border-radius 8px
  background $codeBgLight
  box-shadow 0 2px 4px rgba(0, 0, 0, 0.05)
  font-family 'Fira Code', 'Source Code Pro', Consolas, Monaco, 'Andale Mono', monospace
  line-height 1.5
  overflow hidden
  transition all 0.3s ease
  
  // 代码块顶部工具栏
  &::before
    content ''
    position absolute
    top 0
    left 0
    right 0
    height 2em
    background inherit
    border-bottom 1px solid $codeBorderLight
    border-radius 8px 8px 0 0
  
  // MAC 风格按钮
  .mac-buttons
    position absolute
    top 0.7em
    left 1em
    display flex
    gap 0.5em
    
    span
      width 12px
      height 12px
      border-radius 50%
      transition all 0.2s ease
      
      &.red
        background #ff5f56
        border 1px solid #e0443e
      &.yellow
        background #ffbd2e
        border 1px solid #dea123
      &.green
        background #27c93f
        border 1px solid #1aab29
  
  // 代码语言标签
  .lang-label
    position absolute
    top 0.4em
    right 3.2em
    font-size 0.95em
    color $codeLangLight
    font-family inherit
    opacity 0.8
    padding 0.3em 0.8em
    background transparent
    border-radius 0 0 6px 6px
    font-weight 500
    line-height 1.2
  
  // 复制按钮
  .copy-button
    position absolute
    top 0.45em
    right 0.8em
    padding 0.3em
    color $codeLangLight
    background transparent
    border none
    cursor pointer
    font-size 0.9em
    opacity 0.7
    transition all 0.2s ease
    line-height 1.2
    
    &:hover
      opacity 1
      color #f03838
    
    i
      font-size 1.1em
  
  // 复制成功提示
  .copy-tooltip
    position absolute
    top 0.5em
    right 4.5em
    padding 0.2em 0.6em
    background rgba(0, 0, 0, 0.75)
    color white
    border-radius 3px
    font-size 0.85em
    pointer-events none
    opacity 0
    transform translateY(-5px)
    transition all 0.2s ease
    
    &.visible
      opacity 1
      transform translateY(0)
  
  // 代码区域
  table
    width 100%
    border-spacing 0
    display block  // 修改为块级元素
    overflow-x auto  // 添加横向滚动
    -webkit-overflow-scrolling touch  // 启用平滑滚动
    
  // 行号区域
  .gutter
    padding 0.5em 0.8em
    border-right 1px solid $codeBorderLight
    background rgba(0, 0, 0, 0.02)
    
    pre
      margin 0
      color $codeLineLight
      font-size 0.85em
      text-align right
      user-select none
  
  // 代码内容区域
  .code
    padding 0.5em 1em
    width 100%
    
    pre
      margin 0
      color $codeTextLight
      font-size 0.95em
      white-space pre
      overflow visible  // 确保内容不被截断
      
  // 行高亮
  .marked
    background $codeHighlightLight
    
  // 代码高亮主题 (One Light)
  pre
    .comment, .quote
      color #a0a1a7
      font-style italic

    .doctag, .keyword, .formula
      color #a626a4

    .section, .name, .selector-tag, .deletion, .subst
      color #e45649

    .literal
      color #0184bb

    .string, .regexp, .addition, .attribute, .meta .string
      color #50a14f

    .attr, .variable, .template-variable, .type, .selector-class, .selector-attr, .selector-pseudo, .number
      color #986801

    .symbol, .bullet, .link, .meta, .selector-id, .title
      color #4078f2

    .built_in, .title.class_, .class .title
      color #c18401

    .emphasis
      font-style italic

    .strong
      font-weight bold

// 行内代码
code
  margin 0 0.2em
  padding 0.2em 0.4em
  border-radius 3px
  font-size 0.9em
  font-family 'Fira Code', 'Source Code Pro', monospace
  background rgba(0, 0, 0, 0.05)
  color #e45649

// 暗色模式
@media (prefers-color-scheme dark)
  figure.highlight
    background $codeBgDark
    box-shadow 0 2px 4px rgba(0, 0, 0, 0.2)
    
    &::before
      border-bottom-color $codeBorderDark
    
    .mac-buttons
      span
        opacity 0.8
        
        &:hover
          opacity 1
    
    .lang-label
      color $codeLangDark
      background transparent
    
    .copy-button
      color $codeLangDark
      
      &:hover
        color #f03838
    
    .gutter
      border-right-color $codeBorderDark
      background rgba(0, 0, 0, 0.2)
      
      pre
        color $codeLineDark
    
    .code pre
      color $codeTextDark
    
    .marked
      background $codeHighlightDark
    
    // 代码高亮主题 (One Dark)
    pre
      .comment, .quote
        color #5c6370

      .doctag, .keyword, .formula
        color #c678dd

      .section, .name, .selector-tag, .deletion, .subst
        color #e06c75

      .literal
        color #56b6c2

      .string, .regexp, .addition, .attribute, .meta .string
        color #98c379

      .attr, .variable, .template-variable, .type, .selector-class, .selector-attr, .selector-pseudo, .number
        color #d19a66

      .symbol, .bullet, .link, .meta, .selector-id, .title
        color #61aeee

      .built_in, .title.class_, .class .title
        color #e6c07b

  // 暗色模式行内代码
  code
    background rgba(255, 255, 255, 0.1)
    color #e06c75
